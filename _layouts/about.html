<html>
  <head>
  <link rel="icon" href="tficon/favicon.ico" type="image/x-icon">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>TF-ICON</title>
  <link href="style.css" rel="stylesheet">
  <!--<script type="text/javascript" src="./ptp_files/jquery.mlens-1.0.min.js"></script>-->
  <!--<script type="text/javascript" src="./ptp_files/jquery.js"></script>-->
  <!--  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>-->
    <script type="text/javascript" src="tficon/demo.js"></script>
  </head>
  
  <body>
  <div class="content">
    <h1>TF-ICON: Diffusion-Based Training-Free Cross-Domain <br> Image Composition</h1>
    <p id="authors"><a href="https://shilin-lu.github.io/">Shilin Lu<sup>1</sup></a> <a href="https://sg.linkedin.com/in/yanzhu-liu-b1084736">Yanzhu Liu<sup>2</sup></a> <a href="https://personal.ntu.edu.sg/AdamsKong/">Adams Wai-Kin Kong<sup>1</sup> </a> <br>
  
    <span style="font-size: 16px"><sup>1</sup> School of Computer Science and Engineering, Nanyang Technological University, Singapore  &nbsp;&nbsp;<br> 
      <sup>2</sup> Institute for Infocomm Research (I<sup>2</sup>R) & Centre for Frontier AI Research (CFAR), A*STAR, Singapore
    </span></p>
    <br>
    <img src="./tficon/tf-icon.png" class="teaser-gif" style="width:100%;"><br>
      <font size="+2">
            <p style="text-align: center;">
              <a href="https://arxiv.org/abs/2307.12493" target="_blank">[Paper]</a> &nbsp;&nbsp;&nbsp;&nbsp;
              <a href="https://github.com/Shilin-LU/TF-ICON/" target="_blank">[Code]</a> &nbsp;&nbsp;&nbsp;&nbsp;
              <a href="https://entuedu-my.sharepoint.com/personal/shilin002_e_ntu_edu_sg/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fshilin002%5Fe%5Fntu%5Fedu%5Fsg%2FDocuments%2FTF%2DICON%20Test%20Benchmark&ga=1/" target="_blank">[Benchmark]</a>
            </p>
      </font>
  </div>
  <div class="content">
    <h2 style="text-align:center;">Abstract</h2>
    <p>Text-driven diffusion models have exhibited impressive generative capabilities, enabling various image editing tasks. In this paper, we propose TF-ICON, a novel Training-Free Image COmpositioN framework that harnesses the power of text-driven diffusion models for cross-domain image-guided composition. This task aims to seamlessly integrate user-provided objects into a specific visual context. Current diffusion-based methods often involve costly instance-based optimization or finetuning of pretrained models on customized datasets, which can potentially undermine their rich prior. In contrast, TF-ICON can leverage off-the-shelf diffusion models to perform cross-domain image-guided composition without requiring additional training, finetuning, or optimization. Moreover, we introduce the exceptional prompt, which contains no information, to facilitate text-driven diffusion models in accurately inverting real images into latent representations, forming the basis for compositing. Our experiments show that equipping Stable Diffusion with the exceptional prompt outperforms state-of-the-art inversion methods on various datasets (CelebA-HQ, COCO, and ImageNet), and that TF-ICON surpasses prior baselines in versatile visual domains.</p>
  </div>


  <div class="content">

    <h2>TF-ICON: Cross-Domain Image Composition</h2>
    <p>Our framework facilitates the seamless compositing of subjects from distinct visual domains, leveraging user-provided images alongside the cutting-edge text-driven diffusion model, <a href="https://github.com/Stability-AI/stablediffusion" style="text-decoration: none; color: rgb(212, 65, 114);">Stable Diffusion</a>.
       Through our approach, we are able to effortlessly and precisely edit image contents while ensuring imperceptible transition areas for a truly seamless result.
    </p>
    
    <style>
      .cat-hat-button_a,
      .cat-hat-button_b {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      .cat-hat-button_a img,
      .cat-hat-button_b img {
        width: 120px;
        height: 120px;
      }
    </style>
    
    <div class="cat-hat-main">
      <img class="cat-hat-img" id="cat-hat-img" src="tficon\bg04_burger.png">
      <div class="cat-hat-text">
        <br><br><b>Scenes</b><br><br>
        <span class="cat-hat-bracket">
          <span class="cat-hat-button_a">
            <img src="tficon\bg04.png" alt="bg04">
            photorealism
          </span> &ensp;
          <span class="cat-hat-button_a">
            <img src="tficon\bg61.png" alt="bg61">
            oil painting
          </span> &ensp;
          <span class="cat-hat-button_a">
            <img src="tficon\bg50.png" alt="bg50">
            sketch
          </span> &ensp;
        </span>
        <br><b>Objects</b><br><br>
        <span class="cat-hat-bracket">
          <span class="cat-hat-button_b">
            <img src="tficon\burger.png" alt="...">
            burger
          </span> &ensp;
          <span class="cat-hat-button_b">
            <img src="tficon\croissant.png" alt="floral">
            croissant
          </span> &ensp;
          <span class="cat-hat-button_b">
            <img src="tficon\muffin.png" alt="cylinder">
            muffin
          </span> &ensp;
        </span>
        <br><br>
      </div>
    </div>
    
    <!-- <div class="cat-hat-main">
      <img class="cat-hat-img" id="cat-hat-img" src="./ptp_files/cat_default.png">
     <div class="cat-hat-text"> <span class="cat-hat-bracket">
       <span class="cat-hat-button_a">cat</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">leopard</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">lion</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">horse</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">turtle</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">elephant</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">giraffe</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_a">koala</span></span>
       <br><br> 
       <span class="cat-hat-bracket">  
       <span class="cat-hat-button_b">...</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">floral</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">cylinder</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">police</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">straw</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">swimming</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">pirates</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">musketeer</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">clown</span> &ensp;&ensp;&ensp;&ensp;&ensp; 
       <span class="cat-hat-button_b">unicorn</span></span>
       <br><br> 
     </div>
    </div> -->

  </div>

  
  <div class="content">
  
    <h2>Image Inversion with Exceptional Prompt</h2>
  
    <p>
      In the unconditional setting, solving the diffusion ODE in the reverse direction enables us to obtain the decent latent code for the real image. However, in the text-driven setting, 
      the inversion process is prone to significant reconstruction errors, due to the instability induced by Classifier-Free Guidance (CFG). 
      Our experiments further reveal that even without CFG, the unconditional output of text-driven diffusion models still produce large reconstruction errors. <br><br>
      <img class="summary-img" src="./tficon/inversion1_for_projpage.png" style="width:95%;">
      <br> The invertibility of diffusion models is provided by deterministic sampling. By modeling the diffusion process as a Stochastic Differential Equation (SDE), 
      we can readily identify the associated Probability Flow Ordinary Differential Equation (PF ODE) that shares the same marginal probability density as the original SDE. 
      The connection between their corresponding Partial Differential Equations (which describe the dynamics of their marginal distribution), namely the 
      <a href="https://en.wikipedia.org/wiki/Fokker%E2%80%93Planck_equation" style="text-decoration: none; color: rgb(212, 65, 114);">Fokker-Planck Equation</a> and 
      <a href="https://en.wikipedia.org/wiki/Continuity_equation" style="text-decoration: none; color: rgb(212, 65, 114);">Continuity Equation</a>, enables us to derive the PF ODE. 
      The resulting PF ODE can be solved deterministically and with higher accuracy. <br> <br> 
      
      The CFG disrupts the alignment between the forward and backward ODE trajectories, primarily due to the inclusion of additional information 
      (please refer to <a href="./tficon/tficon.pdf" style="text-decoration: none; color: rgb(212, 65, 114);">Section A.2 of the paper</a> for more details)   
      Intuitively, any information contained within the input prompt can result in the deviation of the backward ODE trajectories from the forward trajectories. 
      To achieve accurate inversion, we present a straightforward yet effective solution, namely <i>exceptional prompt</i>. 
      We remove all information by setting all token numbers to a common value and eliminating positional embeddings for the text prompt. Note that the exceptional prompt is distinguished from the null prompt by its absence of special tokens, 
      such as <u>[startoftext]</u>, <u>[endoftext]</u>, and <u>[pad]</u>, which still retain information. 
      The exceptional prompt is applied only in image inversion but not in the composition process. The choice of the token value does not significantly affect the inversion. <br><br>
      <img class="summary-img" src="./tficon/illegalprompt_for_proj.png" style="width:100%;">    
    </p>
      <!-- <img class="summary-img" src="./tficon/illegalprompt.png" style="width:20%;"> <img class="summary-img" src="./tficon/illegalprompt.png" style="width:30%;"> -->

      <!-- <style>
        /* Flex container to hold the images */
        .image-container {
          display: flex;
        }
      
        /* Ensure images have equal height */
        .image-container img {
          flex: 1; /* Distribute available space equally among images */
          height: 250px; /* Set the desired height */
          object-fit: cover; /* Maintain aspect ratio and fill the container */
          margin: 5px; /* Add some margin between images */
        }
      </style>
      
      <div class="image-container">
        <img src="./tficon/illegalprompt.png" alt="Image 1">
        <img src="./tficon/inversion1.png" alt="Image 2">
      </div>
      <p> -->
  </div>

  <div class="content">
  
    <h2>Image Composition</h2>
    <p>
      The main and reference images are inverted into noises by deterministically solving diffusion ODEs with the exceptional prompt. The accurate latent noises are then composed to form the starting point for the compositional generation.
      This involves  the composition of three constituents for injection at early stage: self-attention maps stored from the main and reference image reconstruction processes, along with cross-attention between the main and reference images.
      For better clarity and readability, the original main and reference images are shown in the pixel space instead of the VAE latent space, and the reference image is presented without resizing and zero-padding. 
    </p>
    <img class="summary-img" src="./tficon/framework_vector.png" style="width:100%;">
  </div>
   
  <div class="content">
  
    <h2>Qualitative comparison</h2>
    <p>
      Qualitative comparison with SOTA and concurrent baselines in image-guided composition for sketching, photorealism, painting, and cartoon animation domains.
    </p>
    <img class="summary-img" src="./tficon/comparison1.png" style="width:100%;">
  </div>

  <div class="content">
  
    <h2>Ablation Study</h2>
    <p>
      Ablation study of different variants of our framework. SA: self-attention. CA: cross-attention.
    </p>
    <img class="summary-img" src="./tficon/Additional_ablation.png" style="width:100%;">
  </div>

  <div class="content">
    <h4>BibTex</h4>
    <p> @article{lu2023tficon,<br>
    &nbsp;&nbsp;title={TF-ICON: Diffusion-Based Training-Free Cross-Domain Image Composition},<br>
    &nbsp;&nbsp;author={Lu, Shilin and Liu, Yanzhu and Kong, Adams Wai-Kin},<br>
    &nbsp;&nbsp;booktitle={Proceedings of the IEEE/CVF International Conference on Computer Vision},<br>
    &nbsp;&nbsp;year={2023}<br>
    } </p>
  </div>

  <div class="content" id="acknowledgements">
  <p><strong>Acknowledgements</strong>
    <p>
      The website template is borrowed from <a href="https://dreambooth.github.io/" style="text-decoration: none; color: rgb(212, 65, 114);">DreamBooth</a> and <a href="https://prompt-to-prompt.github.io/" style="text-decoration: none; color: rgb(212, 65, 114);">Prompt-to-Prompt</a>.
    </p>
  </div>
  </body>
  </html>
          
